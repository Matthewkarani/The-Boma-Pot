import 'package:flutter/material.dart';
import 'package:recipe_recommendation_front_end/pages/recipe_pages/recipe_list_page';

class GetRecipesPage extends StatefulWidget {
  @override
  _GetRecipesPageState createState() => _GetRecipesPageState();
}

class _GetRecipesPageState extends State<GetRecipesPage> {
  final TextEditingController _ingredientsController = TextEditingController();

  // Function to simulate an API call to get recipes
  Future<List<Map<String, dynamic>>> _fetchRecipes(String ingredients) async {
    // Simulate a network delay
    await Future.delayed(Duration(seconds: 2));

    // Sample recipe data to simulate the response from the API
    return [
      {
        'Title': 'Spaghetti Carbonara',
        'Ingredients': 'Spaghetti, Eggs, Cheese, Pancetta, Pepper',
        'Instructions': 'Cook spaghetti, mix with other ingredients, serve hot.',
      },
      {
        'Title': 'Chicken Curry',
        'Ingredients': 'Chicken, Spices, Coconut Milk, Onions',
        'Instructions': 'Cook chicken with spices, add coconut milk, simmer.',
      },
      // Add more sample recipes as needed
    ];
  }

  // Function to handle the search action based on input
  void _searchRecipes() async {
    String ingredients = _ingredientsController.text;

    if (ingredients.isNotEmpty) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('Searching for recipes with: $ingredients')),
      );

      // Fetch recipes from the simulated API
      List<Map<String, dynamic>> recipes = await _fetchRecipes(ingredients);

      // Navigate to RecipeListPage with ingredients and fetched recipes
      Navigator.push(
        context,
        MaterialPageRoute(
          builder: (context) => RecipeListPage(
            ingredients: ingredients,
          
            recipes: recipes,
          ),
        ),
      );
    } else {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('Please enter ingredients')),
      );
    }
  }

  @override
  void dispose() {
    _ingredientsController.dispose(); // Dispose of the controller when not needed
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    // Get the screen size
    final Size screenSize = MediaQuery.of(context).size;

    return Scaffold(
      body: Stack(
        children: [
          // Full-page background image using SizedBox
          SizedBox.expand(
            child: Container(
              decoration: BoxDecoration(
                image: DecorationImage(
                  image: AssetImage('assets/images/addIngredientsPage.png'),
                  fit: BoxFit.cover, // Ensures the image covers the entire screen
                ),
              ),
            ),
          ),
          // Centered content with input box and search button
          Positioned(
            left: screenSize.width * 0.05, // Align to the left
            bottom: screenSize.height * 0.15, // Position just above the home icon
            width: screenSize.width * 0.4, // Occupy the left half of the screen
            child: Padding(
              padding: const EdgeInsets.all(16.0), // Add padding to the left half
              child: Column(
                mainAxisAlignment: MainAxisAlignment.end, // Align to the bottom of the column
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  const Text(
                    'Get ready to excite your taste buds!',
                    style: TextStyle(
                      fontSize: 24,
                      color: Colors.white,
                    ),
                  ),
                  const SizedBox(height: 16), // Spacing between text and input box
                  // Input Box with contrasting hint text color
                  Container(
                    width: double.infinity, // Set input box width to fill its container
                    decoration: BoxDecoration(
                      border: Border.all(color: Colors.white, width: 2), // White border
                      borderRadius: BorderRadius.circular(8), // Rounded corners
                    ),
                    child: TextField(
                      controller: _ingredientsController, // Attach the controller
                      style: const TextStyle(color: Colors.white), // Change text color to white
                      decoration: const InputDecoration(
                        border: InputBorder.none,
                        hintText: 'Please enter your ingredients here',
                        hintStyle: TextStyle(color: Color(0xFFFFD700)), // Light beige color for hint text
                        contentPadding: EdgeInsets.symmetric(horizontal: 10, vertical: 15), // Padding for the input
                      ),
                    ),
                  ),
                  const SizedBox(height: 16), // Spacing between input box and button
                  Container(
                    margin: const EdgeInsets.only(top: 10), // Margin around the button
                    child: Material(
                      elevation: 5, // Add elevation for a shadow effect
                      borderRadius: BorderRadius.circular(8), // Rounded corners
                      child: SizedBox(
                        width: double.infinity, // Set button width to fill its container
                        child: MaterialButton(
                          onPressed: _searchRecipes, // Handle search action
                          color: const Color(0xFF00c4cc), // Button color
                          shape: RoundedRectangleBorder(
                            borderRadius: BorderRadius.circular(8), // Rounded corners
                            side: BorderSide.none, // Remove the border
                          ),
                          padding: const EdgeInsets.symmetric(vertical: 20), // Padding for the button
                          child: const Text(
                            'Search',
                            style: TextStyle(
                              fontSize: 20, // Enlarged text size
                              color: Colors.white, // Text color
                            ),
                          ),
                        ),
                      ),
                    ),
                  ),
                ],
              ),
            ),
          ),
          // Positioned Home Icon
          Positioned(
            bottom: screenSize.height * 0.05, // Adjust the distance from the bottom
            left: screenSize.width * 0.05, // Align to the left to match other elements
            child: GestureDetector(
              onTap: () {
                // Navigate back to the LandingPage with smooth transition
                Navigator.of(context).pop();
              },
              child: Container(
                decoration: BoxDecoration(
                  color: Colors.teal, // Background color for the icon
                  borderRadius: BorderRadius.circular(30), // Rounded corners
                  boxShadow: [
                    BoxShadow(
                      color: Colors.black26,
                      blurRadius: 4.0,
                      spreadRadius: 2.0,
                    ),
                  ],
                ),
                padding: const EdgeInsets.all(12), // Padding around the icon
                child: const Icon(
                  Icons.home,
                  color: Colors.white,
                  size: 30, // Icon size
                ),
              ),
            ),
          ),
        ],
      ),
    );
  }
}
